{"ast":null,"code":"import _createForOfIteratorHelper from\"D:/Soft/DIPLOM PROJECT/IngProject/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";import{drinkSorter}from\"./drinkSorter\";import{passedDrinksCounter}from\"./passedDrinkCounter\";// https://docs.google.com/document/d/1J8gMJdqBdbox462-ERcvf5BYWfcBHa0Hvqrgw0T2bLs/edit\nexport var graphDataCalculator=function graphDataCalculator(_ref){var widmarkFactor=_ref.widmarkFactor,absorptionRate=_ref.absorptionRate,eliminationRate=_ref.eliminationRate,weight=_ref.weight,drinks=_ref.drinks;var descendingDrinks=drinkSorter(drinks,false);var justDrank=parseFloat(descendingDrinks[descendingDrinks.length-1].timePassed)<0.3;var maxTime=parseFloat(descendingDrinks[0].timePassed);var curBacIdx=maxTime/0.01-1;var Time=0;var graphBacData=[];var Bac=0;while(Bac>=0){Bac=0;var _iterator=_createForOfIteratorHelper(descendingDrinks),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var drink=_step.value;if(parseFloat(drink.timePassed)>maxTime-Time){var activeTime=parseFloat(drink.timePassed)-(maxTime-Time);var alcoholMass=parseFloat(drink.volume)*0.0007893*(parseFloat(drink.abv)/100);var numerator=alcoholMass*(1-Math.pow(Math.E,-absorptionRate*activeTime));var denominator=widmarkFactor*weight;Bac=Bac+numerator/denominator*100;}}}catch(err){_iterator.e(err);}finally{_iterator.f();}if(Bac-Time*eliminationRate<0&&Time>maxTime){graphBacData.push(0);break;}else if(Bac-Time*eliminationRate<0){var soberTime=maxTime-Time;if(descendingDrinks.length===1){graphBacData=graphBacData.concat(Array(Math.round(soberTime/0.01)).fill(0));curBacIdx=graphBacData.length-1;break;}else{var passsedDrinks=passedDrinksCounter(descendingDrinks,Time,maxTime);if(passsedDrinks===descendingDrinks.length){graphBacData=graphBacData.concat(Array(Math.round(soberTime/0.01)).fill(0));curBacIdx=graphBacData.length-1;break;}else{soberTime=parseFloat(descendingDrinks[passsedDrinks-1].timePassed)-Time-parseFloat(descendingDrinks[passsedDrinks].timePassed);graphBacData=graphBacData.concat(Array(Math.round(soberTime/0.01)).fill(0));descendingDrinks.splice(0,passsedDrinks);maxTime=parseFloat(descendingDrinks[0].timePassed);Time=0;}}}else{graphBacData.push((Bac-Time*eliminationRate)*10);Time+=0.01;}}var soberingIdx=justDrank?curBacIdx+30:curBacIdx;return{graphBacData:graphBacData,currentBac:graphBacData[curBacIdx],curBacIdx:curBacIdx,soberingIdx:soberingIdx};};","map":{"version":3,"names":["drinkSorter","passedDrinksCounter","graphDataCalculator","widmarkFactor","absorptionRate","eliminationRate","weight","drinks","descendingDrinks","justDrank","parseFloat","length","timePassed","maxTime","curBacIdx","Time","graphBacData","Bac","drink","activeTime","alcoholMass","volume","abv","numerator","Math","E","denominator","push","soberTime","concat","Array","round","fill","passsedDrinks","splice","soberingIdx","currentBac"],"sources":["D:/Soft/DIPLOM PROJECT/IngProject/src/utils/graphDataCalculator.ts"],"sourcesContent":["import { drinkType } from \"../types\"\nimport { drinkSorter } from \"./drinkSorter\"\nimport { passedDrinksCounter } from \"./passedDrinkCounter\"\n\n// https://docs.google.com/document/d/1J8gMJdqBdbox462-ERcvf5BYWfcBHa0Hvqrgw0T2bLs/edit\n\nexport const graphDataCalculator = ({\n  widmarkFactor,\n  absorptionRate,\n  eliminationRate,\n  weight,\n  drinks,\n}: {\n  widmarkFactor: number\n  absorptionRate: number\n  eliminationRate: number\n  weight: number\n  drinks: drinkType[]\n}) => {\n  let descendingDrinks = drinkSorter(drinks, false)\n\n  let justDrank =\n    parseFloat(descendingDrinks[descendingDrinks.length - 1].timePassed) < 0.3\n  let maxTime = parseFloat(descendingDrinks[0].timePassed)\n  let curBacIdx = maxTime / 0.01 - 1\n  let Time = 0\n  let graphBacData: number[] = []\n  let Bac = 0\n\n  while (Bac >= 0) {\n    Bac = 0\n    for (const drink of descendingDrinks) {\n      if (parseFloat(drink.timePassed) > maxTime - Time) {\n        const activeTime = parseFloat(drink.timePassed) - (maxTime - Time)\n        const alcoholMass =\n          parseFloat(drink.volume) * 0.0007893 * (parseFloat(drink.abv) / 100)\n        const numerator =\n          alcoholMass * (1 - Math.E ** (-absorptionRate * activeTime))\n        const denominator = widmarkFactor * weight\n        Bac = Bac + (numerator / denominator) * 100\n      }\n    }\n    if (Bac - Time * eliminationRate < 0 && Time > maxTime) {\n      graphBacData.push(0)\n      break\n    } else if (Bac - Time * eliminationRate < 0) {\n      let soberTime = maxTime - Time\n\n      if (descendingDrinks.length === 1) {\n        graphBacData = graphBacData.concat(\n          Array(Math.round(soberTime / 0.01)).fill(0)\n        )\n        curBacIdx = graphBacData.length - 1\n        break\n      } else {\n        const passsedDrinks = passedDrinksCounter(\n          descendingDrinks,\n          Time,\n          maxTime\n        )\n        if (passsedDrinks === descendingDrinks.length) {\n          graphBacData = graphBacData.concat(\n            Array(Math.round(soberTime / 0.01)).fill(0)\n          )\n          curBacIdx = graphBacData.length - 1\n          break\n        } else {\n          soberTime =\n            parseFloat(descendingDrinks[passsedDrinks - 1].timePassed) -\n            Time -\n            parseFloat(descendingDrinks[passsedDrinks].timePassed)\n          graphBacData = graphBacData.concat(\n            Array(Math.round(soberTime / 0.01)).fill(0)\n          )\n          descendingDrinks.splice(0, passsedDrinks)\n          maxTime = parseFloat(descendingDrinks[0].timePassed)\n          Time = 0\n        }\n      }\n    } else {\n      graphBacData.push((Bac - Time * eliminationRate) * 10)\n      Time += 0.01\n    }\n  }\n  let soberingIdx = justDrank ? curBacIdx + 30 : curBacIdx\n  return {\n    graphBacData,\n    currentBac: graphBacData[curBacIdx],\n    curBacIdx,\n    soberingIdx,\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}