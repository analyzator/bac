{"ast":null,"code":"import _createForOfIteratorHelper from\"D:/Soft/DIPLOM PROJECT/GitProject/bac/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";import{drinkSorter}from\"./drinkSorter\";import{passedDrinksCounter}from\"./passedDrinkCounter\";// https://docs.google.com/document/d/1J8gMJdqBdbox462-ERcvf5BYWfcBHa0Hvqrgw0T2bLs/edit\nexport var graphDataCalculator=function graphDataCalculator(_ref){var widmarkFactor=_ref.widmarkFactor,absorptionRate=_ref.absorptionRate,eliminationRate=_ref.eliminationRate,weight=_ref.weight,drinks=_ref.drinks;var descendingDrinks=drinkSorter(drinks,false);var justDrank=parseFloat(descendingDrinks[descendingDrinks.length-1].timePassed)<0.3;var maxTime=parseFloat(descendingDrinks[0].timePassed);var curBacIdx=maxTime/0.01-1;var Time=0;var graphBacData=[];var Bac=0;while(Bac>=0){Bac=0;var _iterator=_createForOfIteratorHelper(descendingDrinks),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var drink=_step.value;if(parseFloat(drink.timePassed)>maxTime-Time){var activeTime=parseFloat(drink.timePassed)-(maxTime-Time);var alcoholMass=parseFloat(drink.volume)*0.0007893*(parseFloat(drink.abv)/100);var numerator=alcoholMass*(1-Math.pow(Math.E,-absorptionRate*activeTime));var denominator=widmarkFactor*weight;Bac=Bac+numerator/denominator*100;}}}catch(err){_iterator.e(err);}finally{_iterator.f();}if(Bac-Time*eliminationRate<0&&Time>maxTime){graphBacData.push(0);break;}else if(Bac-Time*eliminationRate<0){var soberTime=maxTime-Time;if(descendingDrinks.length===1){graphBacData=graphBacData.concat(Array(Math.round(soberTime/0.01)).fill(0));curBacIdx=graphBacData.length-1;break;}else{var passsedDrinks=passedDrinksCounter(descendingDrinks,Time,maxTime);if(passsedDrinks===descendingDrinks.length){graphBacData=graphBacData.concat(Array(Math.round(soberTime/0.01)).fill(0));curBacIdx=graphBacData.length-1;break;}else{soberTime=parseFloat(descendingDrinks[passsedDrinks-1].timePassed)-Time-parseFloat(descendingDrinks[passsedDrinks].timePassed);graphBacData=graphBacData.concat(Array(Math.round(soberTime/0.01)).fill(0));descendingDrinks.splice(0,passsedDrinks);maxTime=parseFloat(descendingDrinks[0].timePassed);Time=0;}}}else{graphBacData.push((Bac-Time*eliminationRate)*10);Time+=0.01;}}var soberingIdx=justDrank?curBacIdx+30:curBacIdx;return{graphBacData:graphBacData,currentBac:graphBacData[curBacIdx],curBacIdx:curBacIdx,soberingIdx:soberingIdx};};","map":{"version":3,"names":["drinkSorter","passedDrinksCounter","graphDataCalculator","_ref","widmarkFactor","absorptionRate","eliminationRate","weight","drinks","descendingDrinks","justDrank","parseFloat","length","timePassed","maxTime","curBacIdx","Time","graphBacData","Bac","_iterator","_createForOfIteratorHelper","_step","s","n","done","drink","value","activeTime","alcoholMass","volume","abv","numerator","Math","pow","E","denominator","err","e","f","push","soberTime","concat","Array","round","fill","passsedDrinks","splice","soberingIdx","currentBac"],"sources":["D:/Soft/DIPLOM PROJECT/GitProject/bac/src/utils/graphDataCalculator.ts"],"sourcesContent":["import { drinkType } from \"../types\"\nimport { drinkSorter } from \"./drinkSorter\"\nimport { passedDrinksCounter } from \"./passedDrinkCounter\"\n\n// https://docs.google.com/document/d/1J8gMJdqBdbox462-ERcvf5BYWfcBHa0Hvqrgw0T2bLs/edit\n\nexport const graphDataCalculator = ({\n  widmarkFactor,\n  absorptionRate,\n  eliminationRate,\n  weight,\n  drinks,\n}: {\n  widmarkFactor: number\n  absorptionRate: number\n  eliminationRate: number\n  weight: number\n  drinks: drinkType[]\n}) => {\n  let descendingDrinks = drinkSorter(drinks, false)\n\n  let justDrank =\n    parseFloat(descendingDrinks[descendingDrinks.length - 1].timePassed) < 0.3\n  let maxTime = parseFloat(descendingDrinks[0].timePassed)\n  let curBacIdx = maxTime / 0.01 - 1\n  let Time = 0\n  let graphBacData: number[] = []\n  let Bac = 0\n\n  while (Bac >= 0) {\n    Bac = 0\n    for (const drink of descendingDrinks) {\n      if (parseFloat(drink.timePassed) > maxTime - Time) {\n        const activeTime = parseFloat(drink.timePassed) - (maxTime - Time)\n        const alcoholMass =\n          parseFloat(drink.volume) * 0.0007893 * (parseFloat(drink.abv) / 100)\n        const numerator =\n          alcoholMass * (1 - Math.E ** (-absorptionRate * activeTime))\n        const denominator = widmarkFactor * weight\n        Bac = Bac + (numerator / denominator) * 100\n      }\n    }\n    if (Bac - Time * eliminationRate < 0 && Time > maxTime) {\n      graphBacData.push(0)\n      break\n    } else if (Bac - Time * eliminationRate < 0) {\n      let soberTime = maxTime - Time\n\n      if (descendingDrinks.length === 1) {\n        graphBacData = graphBacData.concat(\n          Array(Math.round(soberTime / 0.01)).fill(0)\n        )\n        curBacIdx = graphBacData.length - 1\n        break\n      } else {\n        const passsedDrinks = passedDrinksCounter(\n          descendingDrinks,\n          Time,\n          maxTime\n        )\n        if (passsedDrinks === descendingDrinks.length) {\n          graphBacData = graphBacData.concat(\n            Array(Math.round(soberTime / 0.01)).fill(0)\n          )\n          curBacIdx = graphBacData.length - 1\n          break\n        } else {\n          soberTime =\n            parseFloat(descendingDrinks[passsedDrinks - 1].timePassed) -\n            Time -\n            parseFloat(descendingDrinks[passsedDrinks].timePassed)\n          graphBacData = graphBacData.concat(\n            Array(Math.round(soberTime / 0.01)).fill(0)\n          )\n          descendingDrinks.splice(0, passsedDrinks)\n          maxTime = parseFloat(descendingDrinks[0].timePassed)\n          Time = 0\n        }\n      }\n    } else {\n      graphBacData.push((Bac - Time * eliminationRate) * 10)\n      Time += 0.01\n    }\n  }\n  let soberingIdx = justDrank ? curBacIdx + 30 : curBacIdx\n  return {\n    graphBacData,\n    currentBac: graphBacData[curBacIdx],\n    curBacIdx,\n    soberingIdx,\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}